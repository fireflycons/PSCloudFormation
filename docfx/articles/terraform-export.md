# Terraform Export

<span style="color: red">**Highly experimental!**</span>

## Disclaimer

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

Basically, if you damage an existing production system by applying terraform configuration generated by this tool, that is your problem. <span style="color: red">This tool serves as an _aid_ in migrating a CloudFormation stack to Terraform, _not a de-facto solution_</span>.

You are strongly advised to deploy a copy of a production stack elsewhere, export that, then manually edit the configuration generated by this tool and apply to your test stack until you obtain the desired results, then follow your internal change control process before turning loose on a live production stack (you do have a change control process, right?).

## Prerequisites

To use the [Export-PSCFNTerraform](xref:Export-PSCFNTerraform) cmdlet, you must have the Terraform CLI installed and able to be found in the path. See the [Terraform downloads](https://www.terraform.io/downloads.html) page. If the CLI binary cannot be located, the cmdlet exits with an error.

## Supported Terraform Versions

As of December 2021, this has been tested with
* Terraform v1.0.0 and v1.1.0, but should work with 0.12 and later when the HCL syntax was updated.
* AWS Provider >= 3.63

## About

Given a scenario where your organisation has dictated that all native CloudFormation stacks should be migrated to Terraform, this cmdlet goes some way to easing the pain of that operation. Currently [terraform import](https://www.terraform.io/docs/cli/import/index.html) does not generate [HCL](https://www.terraform.io/docs/language/index.html) code for imported resources, only state information leaving the user to work out and add in all the attributes for every imported resource.

The [Export-PSCFNTerraform](xref:Export-PSCFNTerraform) cmdlet will read a deployed CloudFormation Stack via the AWS CloudFormation Service APIs and make a best attempt at generating HCL for the resources the stack contains. Additionally it will try to fix up dependencies between these resources, input variables (stack parameters) and output values as best it can. Thus the amount of work to be done in getting the HCL for the stack correct is greatly reduced.

The cmdlet is also capable of exporting nested stacks as Terraform modules when run with the `-ExportNestedStacks` argument, and will resolve the dependencies between module inputs and outputs against other objects in the configuration. If this argument is omitted, then only the root stack is exported with `aws_cloudformation_stack` resources for each nested stack.

## More Details

* Read about various [caveats here](xref:tf-caveats).
* How to [migrate a stack](xref:tf-migrating).
* See the [export workflow](xref:tf-workflow).
* Examples
    * [VPC Stack](xref:tf-example-vpc-stack).
    * [Lambda Stack](xref:tf-example-lambda-stack).
    * [Nested Stacks](xref:tf-example-nested).

This tool makes heavy use of my [CloudFormation Parser](https://fireflycons.github.io/Firefly.CloudFormationParser) module, and is the main reason for that module's inception.

## Future Improvements

* Increase the number of mapped resources.
* Learn GoLang and become a contributor to the Terraform AWS provider üòÅ

