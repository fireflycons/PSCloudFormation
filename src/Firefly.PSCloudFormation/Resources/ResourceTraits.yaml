#####################################################################################################
#
# Very much a work in progress! Resources getting added all the time.
#
# This file contains lists of resource attributes that require special handling
# when emitting HCL. They are grouped as follows
#
# DefaultValues
#    A map of attribute name to default value to provide defaults for required attributes
#    that have a null or empty value in the state file.
#
# ConflictingArguments
#    A list of lists of attributes that conflict if both present in resource definition.
#    Where conflicts are found, the first attribute in the sub-list is emitted and the
#    reamining ones supressed.
#
# For each of these attributes, they should be specified in 'path' syntax, eg.
# resource "null_resource" "test" {
#   arn = "arn:aws:blah"                    # Path is 'arn'
#   my_list [
#      {
#        "value1"                           # Path is 'my_list.#.value1'. All 'value1' is included
#      }
#   ]
#   my_map1 = {
#     my_map2 = {
#       my_key = "my-value"                  # Path is 'my_map1.my_map2.my_key'
#     }
#   }
#   my_block {
#     my_key = "my_value"                    # Path is 'my_block.#.my_key' because some blocks are repeatable.
#   }
# }
#
# Wildcards may be specificed anywhere in the key path
# '*arn' matches all root-level attributes with names ending in 'arn'
#
#####################################################################################################

- Group: all
  Resources:
    - Resource: all                   # Common traits for all resources - merged with specific resources.
      DefaultValues: {}               # Values to set if state value is null
      ConflictingArguments: []        # Where arguments confict. choose the first from this list.
      ConditionalAttributes: []
      AttributeMap: {}                # Where HCL and CF attributes are quire different
      MissingFromSchema: []           # Attrinbutes found in state file that have no schema definition

- Group: Autoscaling
  Resources:
    - Resource: aws_autoscaling_group
      ConflictingArguments:
        - - vpc_zone_identifier
          - availability_zones
        - - launch_template.#.id
          - launch_template.#.name

- Group: CloudWatch
  Resources:
    - Resource: aws_cloudwatch_metric_alarm
      ConditionalAttributes:
        - Name: datapoints_to_alarm
          Value: 0

- Group: Cognito
  Resources:
    - Resource: aws_cognito_user_pool
      ConflictingArguments:
        - - email_verification_message
          - verification_message_template.0.email_message
        - - email_verification_subject
          - verification_message_template.0.email_subject
        - - sms_verification_message
          - verification_message_template.0.sms_message

- Group: DynamoDB
  Resources:
    - Resource: aws_dynamodb_table
      MissingFromSchema:
        - ttl.0.kms_key_arn

- Group: EC2
  Resources:
    - Resource: aws_launch_template
      ConditionalAttributes:
        - Name: block_device_mappings.#.ebs.#.throughput
          Value: 0
      AttributeMap:
        LatestVersionNumber: latest_version
        DefaultVersionNumber: default_version
    - Resource: aws_eip
      AttributeMap:
        AllocationId: id

- Group: ECS
  Resources:
    - Resource: aws_ecs_service
      ConditionalAttributes:
        - Name: propagate_tags
          Value: NONE

- Group: Elastic Loadbalancing V2
  Resources:
    - Resource: aws_lb
      AttributeMap:
        LoadBalancerFullName: arn_suffix
    - Resource: aws_lb_target_group
      AttributeMap:
        TargetGroupFullName: arn_suffix
    - Resource: aws_lb_listener
      ConditionalAttributes:
        - Name: default_action.#.order
          Value: 0
    - Resource: aws_lb_listener_rule
      ConditionalAttributes:
        - Name: action.#.order
          Value: 0

- Group: IAM
  Resources:
    - Resource: aws_iam_role
      ConflictingArguments:
        - - name
          - name_prefix

- Group: Route53
  Resources:
    - Resource: aws_route53_record
      ConflictingArguments:
        - - ttl
          - alias

- Group: S3
  Resources:
    - Resource: aws_s3_bucket
      DefaultValues:
        acl: private
        force_destroy: false
      AttributeMap:
        BucketName: bucket

- Group: VPC
  Resources:
    - Resource: aws_subnet
      ConflictingArguments:
        - - availability_zone
          - availability_zone_id
